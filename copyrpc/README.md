# copyrpc

基本はSPSCのリングとして実装する。
相互にメモリバッファのリングを用意し、送信時はローカルに貯めておき定期的で明示的な送信処理で内容をWRITE＋IMMで転送することで通信を行う。
バッファ管理は基本的に/32された単調増加の仮想アドレスを使い、Immediateで差分を通知することでWRITEでの転送量を管理する。
consumedの位置はpiggybackで通信し、基本はキャッシュして管理することでオーバーヘッドを減らす。
ハング防止のため、consumedに追いついてしまった場合はRDMA READでの直接取得によって、対向の消費位置を獲得する。
基本的な構造として、まずCqやSrqをラップした`Context`を作る。この`Context`に`recv`メソッドがあり、これで受信が可能。
返信は`recv`で取ってきたハンドラに`reply`メソッドを呼び出すことで返信する。送信については、`Context`から`create_ep`メソッドをお互いに呼んで接続。
